{"version":3,"names":["cov_12fo6y2j5j","actualCoverage","s","unified_config_service_1","require","user_targeting_1","FeatureFlagsService","getInstance","f","instance","b","getFeatureFlag","flagName","configKey","globalValue","unifiedConfigService","get","rolloutConfig","UserTargetingService","ROLLOUT_CONFIGS","userTargetingService","isCurrentUserInRollout","error","console","getAllFeatureFlags","allConfigs","getAll","globalFlags","autoApplyAzure","portalIntegration","voiceInterview","premiumFeatures","newUI","rolloutStatus","getCurrentUserRolloutStatus","enhancedFlags","isFeatureEnabled","featureName","isAutoApplyAzureEnabled","isPortalIntegrationEnabled","getDebugInfo","unifiedConfig","finalFlags","userId","getCurrentUserId","rolloutConfigs","refreshFeatureFlags","refresh","exports","featureFlagsService"],"sources":["/Users/dikshantvashistha/PrepBettr/lib/services/feature-flags.ts"],"sourcesContent":["import { unifiedConfigService } from './unified-config-service';\nimport { userTargetingService, UserTargetingService } from './user-targeting';\n\n// Updated interface to match unified config schema\nexport interface FeatureFlags {\n  autoApplyAzure: boolean;\n  portalIntegration: boolean;\n  voiceInterview: boolean;\n  premiumFeatures: boolean;\n  newUI: boolean;\n}\n\nexport interface EnhancedFeatureFlags extends FeatureFlags {\n  // Rollout status for each feature\n  rolloutStatus: {\n    autoApplyAzure: boolean;\n    portalIntegration: boolean;\n    voiceInterview: boolean;\n    premiumFeatures: boolean;\n    newUI: boolean;\n  };\n}\n\nclass FeatureFlagsService {\n  private static instance: FeatureFlagsService;\n\n  static getInstance(): FeatureFlagsService {\n    if (!FeatureFlagsService.instance) {\n      FeatureFlagsService.instance = new FeatureFlagsService();\n    }\n    return FeatureFlagsService.instance;\n  }\n\n  /**\n   * Get feature flag value considering both remote config and user targeting\n   */\n  async getFeatureFlag(flagName: keyof FeatureFlags): Promise<boolean> {\n    try {\n      // Get feature flag from unified config service\n      const configKey = `features.${flagName}`;\n      const globalValue = await unifiedConfigService.get<boolean>(configKey, false);\n      \n      if (!globalValue) {\n        // If disabled globally, return false\n        return false;\n      }\n\n      // If enabled globally, check if user is in the rollout\n      const rolloutConfig = UserTargetingService.ROLLOUT_CONFIGS[flagName];\n      if (!rolloutConfig) {\n        // If no rollout config, default to global setting\n        return globalValue;\n      }\n\n      return userTargetingService.isCurrentUserInRollout(rolloutConfig);\n    } catch (error) {\n      console.error(`Error getting feature flag ${flagName}:`, error);\n      return false; // Default to disabled on error\n    }\n  }\n\n  /**\n   * Get all feature flags with rollout status\n   */\n  async getAllFeatureFlags(): Promise<EnhancedFeatureFlags> {\n    try {\n      // Get all feature flags from unified config service\n      const allConfigs = await unifiedConfigService.getAll('features.');\n      \n      // Extract flags from config keys\n      const globalFlags: FeatureFlags = {\n        autoApplyAzure: allConfigs['features.autoApplyAzure'] || false,\n        portalIntegration: allConfigs['features.portalIntegration'] || false,\n        voiceInterview: allConfigs['features.voiceInterview'] || false,\n        premiumFeatures: allConfigs['features.premiumFeatures'] || false,\n        newUI: allConfigs['features.newUI'] || false\n      };\n      \n      // Get rollout status for current user\n      const rolloutStatus = userTargetingService.getCurrentUserRolloutStatus();\n      \n      // Combine both: feature must be enabled globally AND user must be in rollout\n      const enhancedFlags: EnhancedFeatureFlags = {\n        autoApplyAzure: globalFlags.autoApplyAzure && rolloutStatus.autoApplyAzure,\n        portalIntegration: globalFlags.portalIntegration && rolloutStatus.portalIntegration,\n        voiceInterview: globalFlags.voiceInterview && rolloutStatus.voiceInterview,\n        premiumFeatures: globalFlags.premiumFeatures && rolloutStatus.premiumFeatures,\n        newUI: globalFlags.newUI && rolloutStatus.newUI,\n        rolloutStatus: {\n          autoApplyAzure: rolloutStatus.autoApplyAzure || false,\n          portalIntegration: rolloutStatus.portalIntegration || false,\n          voiceInterview: rolloutStatus.voiceInterview || false,\n          premiumFeatures: rolloutStatus.premiumFeatures || false,\n          newUI: rolloutStatus.newUI || false\n        },\n      };\n\n      return enhancedFlags;\n    } catch (error) {\n      console.error('Error getting all feature flags:', error);\n      return {\n        autoApplyAzure: false,\n        portalIntegration: false,\n        voiceInterview: false,\n        premiumFeatures: false,\n        newUI: false,\n        rolloutStatus: {\n          autoApplyAzure: false,\n          portalIntegration: false,\n          voiceInterview: false,\n          premiumFeatures: false,\n          newUI: false\n        },\n      };\n    }\n  }\n\n  /**\n   * Check if a specific feature is enabled for the current user\n   */\n  async isFeatureEnabled(featureName: keyof FeatureFlags): Promise<boolean> {\n    return this.getFeatureFlag(featureName);\n  }\n\n  /**\n   * Convenience methods for specific features\n   */\n  async isAutoApplyAzureEnabled(): Promise<boolean> {\n    return this.getFeatureFlag('autoApplyAzure');\n  }\n\n  async isPortalIntegrationEnabled(): Promise<boolean> {\n    return this.getFeatureFlag('portalIntegration');\n  }\n\n  /**\n   * Get debug information about feature flags\n   */\n  async getDebugInfo(): Promise<{\n    unifiedConfig: Record<string, any>;\n    rolloutStatus: Record<string, boolean>;\n    finalFlags: FeatureFlags;\n    userId: string | null;\n    rolloutConfigs: typeof UserTargetingService.ROLLOUT_CONFIGS;\n  }> {\n    const unifiedConfig = await unifiedConfigService.getAll('features.');\n    const rolloutStatus = userTargetingService.getCurrentUserRolloutStatus();\n    const finalFlags = await this.getAllFeatureFlags();\n    const userId = userTargetingService.getCurrentUserId();\n\n    return {\n      unifiedConfig,\n      rolloutStatus,\n      finalFlags: {\n        autoApplyAzure: finalFlags.autoApplyAzure,\n        portalIntegration: finalFlags.portalIntegration,\n        voiceInterview: finalFlags.voiceInterview,\n        premiumFeatures: finalFlags.premiumFeatures,\n        newUI: finalFlags.newUI\n      },\n      userId,\n      rolloutConfigs: UserTargetingService.ROLLOUT_CONFIGS,\n    };\n  }\n\n  /**\n   * Force refresh all feature flags\n   */\n  async refreshFeatureFlags(): Promise<EnhancedFeatureFlags> {\n    await unifiedConfigService.refresh();\n    return this.getAllFeatureFlags();\n  }\n}\n\n// Export singleton instance\nexport const featureFlagsService = FeatureFlagsService.getInstance();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}
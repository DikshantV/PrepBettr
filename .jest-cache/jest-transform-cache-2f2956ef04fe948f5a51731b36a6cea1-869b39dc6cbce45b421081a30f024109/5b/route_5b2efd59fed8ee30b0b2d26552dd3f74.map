{"version":3,"names":["cov_1liooiurah","actualCoverage","s","exports","GET","server_1","require","headers_1","GOOGLE_CLIENT_ID","process","env","GOOGLE_CLIENT_ID_SUFFIX","GOOGLE_CLIENT_SECRET","NEXTAUTH_URL","b","request","f","console","log","searchParams","nextUrl","code","get","state","error","NextResponse","redirect","cookieStore","cookies","storedState","_a","value","tokenResponse","fetch","method","headers","body","URLSearchParams","client_id","client_secret","grant_type","redirect_uri","ok","tokenError","text","tokens","json","userResponse","Authorization","access_token","googleUser","email","mockJwtPayload","uid","id","email_verified","verified_email","name","picture","provider","iss","aud","exp","Math","floor","Date","now","iat","mockToken","btoa","JSON","stringify","set","httpOnly","secure","NODE_ENV","maxAge","path","sameSite","delete"],"sources":["/Users/dikshantvashistha/PrepBettr/app/api/auth/google/callback/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\n\nconst GOOGLE_CLIENT_ID = process.env.GOOGLE_CLIENT_ID_SUFFIX;\nconst GOOGLE_CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;\nconst NEXTAUTH_URL = process.env.NEXTAUTH_URL || 'http://localhost:3000';\n\ninterface GoogleTokenResponse {\n  access_token: string;\n  expires_in: number;\n  refresh_token?: string;\n  scope: string;\n  token_type: string;\n  id_token: string;\n}\n\ninterface GoogleUserInfo {\n  id: string;\n  email: string;\n  verified_email: boolean;\n  name: string;\n  given_name?: string;\n  family_name?: string;\n  picture?: string;\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    console.log('üåê Google OAuth callback: Processing response');\n    \n    const searchParams = request.nextUrl.searchParams;\n    const code = searchParams.get('code');\n    const state = searchParams.get('state');\n    const error = searchParams.get('error');\n\n    if (error) {\n      console.error('üåê Google OAuth callback: OAuth error:', error);\n      return NextResponse.redirect(`${NEXTAUTH_URL}/sign-in?error=oauth_error`);\n    }\n\n    if (!code || !state) {\n      console.error('üåê Google OAuth callback: Missing code or state');\n      return NextResponse.redirect(`${NEXTAUTH_URL}/sign-in?error=missing_params`);\n    }\n\n    // Verify state parameter\n    const cookieStore = await cookies();\n    const storedState = cookieStore.get('oauth_state')?.value;\n    \n    if (storedState !== state) {\n      console.error('üåê Google OAuth callback: Invalid state parameter');\n      return NextResponse.redirect(`${NEXTAUTH_URL}/sign-in?error=invalid_state`);\n    }\n\n    // Exchange code for tokens\n    const tokenResponse = await fetch('https://oauth2.googleapis.com/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        client_id: GOOGLE_CLIENT_ID!,\n        client_secret: GOOGLE_CLIENT_SECRET!,\n        code,\n        grant_type: 'authorization_code',\n        redirect_uri: `${NEXTAUTH_URL}/api/auth/google/callback`,\n      }),\n    });\n\n    if (!tokenResponse.ok) {\n      const tokenError = await tokenResponse.text();\n      console.error('üåê Google OAuth callback: Token exchange failed:', tokenError);\n      return NextResponse.redirect(`${NEXTAUTH_URL}/sign-in?error=token_exchange_failed`);\n    }\n\n    const tokens: GoogleTokenResponse = await tokenResponse.json();\n    console.log('üåê Google OAuth callback: Tokens received successfully');\n\n    // Get user info from Google\n    const userResponse = await fetch('https://www.googleapis.com/oauth2/v1/userinfo', {\n      headers: {\n        Authorization: `Bearer ${tokens.access_token}`,\n      },\n    });\n\n    if (!userResponse.ok) {\n      console.error('üåê Google OAuth callback: Failed to fetch user info');\n      return NextResponse.redirect(`${NEXTAUTH_URL}/sign-in?error=user_info_failed`);\n    }\n\n    const googleUser: GoogleUserInfo = await userResponse.json();\n    console.log('üåê Google OAuth callback: User info received:', googleUser.email);\n\n    // Create a simple JWT-like token for session (mock Firebase token structure)\n    const mockJwtPayload = {\n      uid: `google-${googleUser.id}`,\n      email: googleUser.email,\n      email_verified: googleUser.verified_email,\n      name: googleUser.name,\n      picture: googleUser.picture,\n      provider: 'google.com',\n      iss: 'prepbettr-server-auth',\n      aud: 'prepbettr',\n      exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60), // 24 hours\n      iat: Math.floor(Date.now() / 1000),\n    };\n\n    // Create a simple base64 encoded token (not secure for production, but works for development)\n    const mockToken = `eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.${btoa(JSON.stringify(mockJwtPayload))}.server-auth-signature`;\n\n    // Set session cookie\n    cookieStore.set('session', mockToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      maxAge: 24 * 60 * 60, // 24 hours\n      path: '/',\n      sameSite: 'lax',\n    });\n\n    // Clear the OAuth state cookie\n    cookieStore.delete('oauth_state');\n\n    console.log('üåê Google OAuth callback: Authentication successful, redirecting to dashboard');\n    \n    // Redirect to dashboard\n    return NextResponse.redirect(`${NEXTAUTH_URL}/dashboard`);\n\n  } catch (error) {\n    console.error('üåê Google OAuth callback error:', error);\n    return NextResponse.redirect(`${NEXTAUTH_URL}/sign-in?error=callback_error`);\n  }\n}"],"mappings":"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","ignoreList":[]}
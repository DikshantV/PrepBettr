{"file":"/Users/dikshantvashistha/PrepBettr/lib/services/azure-openai-service.ts","mappings":"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","names":[],"sources":["/Users/dikshantvashistha/PrepBettr/lib/services/azure-openai-service.ts"],"sourcesContent":["import OpenAI from 'openai';\nimport { InterviewContext } from '@/lib/types/voice';\n\n// Client-side safety check\nconst isClient = typeof window !== 'undefined';\n\n// Only import server-side dependencies when running on server\nlet fetchAzureSecrets: any = null;\n\nif (!isClient) {\n  const azureConfig = require('@/lib/azure-config');\n  fetchAzureSecrets = azureConfig.fetchAzureSecrets;\n}\n\nexport interface ConversationMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\nexport interface GenerationResponse {\n  content: string;\n  questionNumber?: number;\n  isComplete?: boolean;\n  followUpSuggestions?: string[];\n}\n\nexport class AzureOpenAIService {\n  private client: OpenAI | null = null;\n  private isInitialized = false;\n  private deployment: string = '';\n  private conversationHistory: ConversationMessage[] = [];\n  private interviewContext: InterviewContext = { \n    type: 'general',\n    preliminaryCollected: false,\n    currentQuestionCount: 0,\n    maxQuestions: 10\n  };\n\n  /**\n   * Initialize the Azure OpenAI service\n   */\n  async initialize(): Promise<boolean> {\n    if (isClient) {\n      console.warn('[Azure OpenAI Service] Running on client side - service disabled');\n      return false;\n    }\n    \n    try {\n      const secrets = await fetchAzureSecrets();\n      \n      if (!secrets.azureOpenAIKey || !secrets.azureOpenAIEndpoint) {\n        console.warn('⚠️ Azure OpenAI credentials not available');\n        return false;\n      }\n\n      this.deployment = secrets.azureOpenAIDeployment;\n      this.client = new OpenAI({\n        apiKey: secrets.azureOpenAIKey,\n        baseURL: `${secrets.azureOpenAIEndpoint}/openai/deployments/${secrets.azureOpenAIDeployment}`,\n        defaultQuery: { 'api-version': '2025-01-01-preview' }, // Latest API version for gpt-4o support\n        defaultHeaders: {\n          'api-key': secrets.azureOpenAIKey,\n        },\n      });\n\n      // Test the connection with a simple request\n      try {\n        console.log(`🔄 Testing Azure OpenAI connection with deployment: ${this.deployment}`);\n        await this.client.chat.completions.create({\n          model: this.deployment,\n          messages: [{ role: 'user', content: 'Test' }],\n          max_tokens: 5,\n        });\n        \n        this.isInitialized = true;\n        console.log('✅ Azure OpenAI Service initialized and tested successfully');\n        return true;\n      } catch (testError: any) {\n        console.error('❌ Azure OpenAI connection test failed:', testError.message);\n        console.error('📋 Configuration details:', {\n          endpoint: secrets.azureOpenAIEndpoint,\n          deployment: this.deployment,\n          hasApiKey: !!secrets.azureOpenAIKey\n        });\n        \n        if (testError.status === 401) {\n          console.error('🔐 Authentication Error (401):');\n          console.error('   • Your API key might be invalid or expired');\n          console.error('   • Check your Azure OpenAI resource for the correct key');\n        } else if (testError.status === 404) {\n          console.error('📍 Resource Not Found (404):');\n          console.error('   • The deployment \"' + this.deployment + '\" does not exist');\n          console.error('   • Your endpoint URL might be incorrect');\n          console.error('   • No deployments might exist in your Azure OpenAI resource');\n          console.error('💡 To fix this:');\n          console.error('   1. Log into portal.azure.com');\n          console.error('   2. Navigate to your Azure OpenAI resource');\n          console.error('   3. Check the \"Model deployments\" or \"Deployments\" section');\n          console.error('   4. Create a deployment (e.g., gpt-35-turbo, gpt-4)');\n          console.error('   5. Update AZURE_OPENAI_DEPLOYMENT in your .env.local file');\n        } else if (testError.status === 403) {\n          console.error('🚫 Access Forbidden (403):');\n          console.error('   • Your API key might not have the right permissions');\n          console.error('   • Your Azure OpenAI resource might not be properly configured');\n        } else {\n          console.error(`❓ Unexpected error (${testError.status || 'Unknown'}):`);\n          console.error('   • Check your Azure OpenAI resource configuration');\n          console.error('   • Verify your subscription and resource status');\n        }\n        return false;\n      }\n    } catch (error) {\n      console.error('❌ Failed to initialize Azure OpenAI Service:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Set interview context for conversation management\n   */\n  setInterviewContext(context: Partial<InterviewContext>): void {\n    const previousState = { ...this.interviewContext };\n    \n    // Merge context while preserving defaults\n    this.interviewContext = { \n      ...this.interviewContext, \n      ...context,\n      // Ensure defaults are set if not provided\n      preliminaryCollected: context.preliminaryCollected ?? this.interviewContext.preliminaryCollected ?? false,\n      currentQuestionCount: context.currentQuestionCount ?? this.interviewContext.currentQuestionCount ?? 0,\n      maxQuestions: context.maxQuestions ?? this.interviewContext.maxQuestions ?? 10\n    };\n    \n    // Log state transition\n    console.log('📋 Interview context updated:', this.interviewContext);\n    console.debug('🔄 [STATE_TRANSITION] Interview context changed', {\n      from: previousState,\n      to: this.interviewContext,\n      changes: {\n        preliminaryCollected: previousState.preliminaryCollected !== this.interviewContext.preliminaryCollected,\n        currentQuestionCount: previousState.currentQuestionCount !== this.interviewContext.currentQuestionCount,\n        maxQuestions: previousState.maxQuestions !== this.interviewContext.maxQuestions\n      },\n      timestamp: new Date().toISOString()\n    });\n  }\n\n  /**\n   * Get system prompt based on interview context\n   */\n  private getSystemPrompt(): string {\n    const { type, position, company, difficulty } = this.interviewContext;\n    \n    let basePrompt = `You are an experienced AI interviewer conducting a ${type} interview. Your goal is to create an engaging, realistic interview experience that helps candidates prepare effectively.\n\nCore Interview Principles:\n1. Ask relevant, progressively challenging questions\n2. Provide thoughtful follow-ups based on candidate responses\n3. Maintain a professional yet conversational tone\n4. Show genuine interest in the candidate's experiences\n5. Adapt question difficulty based on their expertise level\n6. Give brief encouraging feedback when appropriate\n7. Keep responses concise (50-80 words) and ask one question at a time\n\n`;\n\n    if (position) {\n      basePrompt += `Target Position: ${position}\\n`;\n    }\n    if (company) {\n      basePrompt += `Company Context: ${company}\\n`;\n    }\n    if (difficulty) {\n      basePrompt += `Difficulty Level: ${difficulty}\\n`;\n    }\n\n    switch (type) {\n      case 'technical':\n        basePrompt += `\\nTechnical Interview Focus:\n- Start with foundational concepts, then progress to complex scenarios\n- Ask about specific technologies, algorithms, and system design\n- Explore problem-solving approaches and trade-offs\n- Include practical coding scenarios and architecture discussions\n- Ask \"How would you optimize this?\" or \"What challenges might arise?\"\n- Focus on real-world application of technical knowledge`;\n        break;\n      case 'behavioral':\n        basePrompt += `\\nBehavioral Interview Focus:\n- Use STAR method (Situation, Task, Action, Result) evaluation\n- Ask about leadership, teamwork, conflict resolution, and growth\n- Explore past experiences with specific examples\n- Ask follow-ups like \"What would you do differently?\" or \"What did you learn?\"\n- Focus on cultural fit, communication skills, and problem-solving approach\n- Include questions about handling failures and difficult situations`;\n        break;\n      default:\n        basePrompt += `\\nGeneral Interview Focus:\n- Balance background, experience, motivation, and role fit\n- Ask about career goals, interests, and what excites them about the opportunity\n- Explore their understanding of the role and company\n- Include questions about learning style and professional development\n- Ask about their greatest achievements and challenges`;\n    }\n\n    basePrompt += `\\n\\nInterview Style:\n- Be conversational and show active listening\n- Acknowledge good points: \"That's a great approach\" or \"Interesting perspective\"\n- Ask natural follow-ups that build on their responses\n- Create a comfortable environment that encourages detailed answers`;\n    \n    return basePrompt;\n  }\n\n  /**\n   * Start a new interview conversation\n   */\n  async startInterviewConversation(): Promise<GenerationResponse> {\n    console.log('🚀 [TRACE] startInterviewConversation called', {\n      timestamp: new Date().toISOString(),\n      interviewContext: this.interviewContext,\n      isInitialized: this.isInitialized,\n      callStack: new Error().stack?.split('\\n').slice(0, 5).join('\\n')\n    });\n    \n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    // Reset conversation history\n    this.conversationHistory = [\n      { role: 'system', content: this.getSystemPrompt() }\n    ];\n\n    const openingMessage = this.getOpeningMessage();\n    \n    console.log('📢 [TRACE] Opening message generated', {\n      message: openingMessage,\n      interviewType: this.interviewContext.type,\n      isPreliminaryQuestion: openingMessage.includes('tell me about your current role'),\n      timestamp: new Date().toISOString()\n    });\n    \n    this.conversationHistory.push({ role: 'assistant', content: openingMessage });\n\n    return {\n      content: openingMessage,\n      questionNumber: 1,\n      isComplete: false\n    };\n  }\n\n  /**\n   * Get opening message based on interview type\n   */\n  private getOpeningMessage(): string {\n    const { type, position, preliminaryCollected } = this.interviewContext;\n    \n    console.log('🎯 [TRACE] getOpeningMessage called', {\n      type,\n      position,\n      preliminaryCollected,\n      timestamp: new Date().toISOString(),\n      callStack: new Error().stack?.split('\\n').slice(0, 5).join('\\n')\n    });\n    \n    // Always greet user\n    let greeting = \"Hello! I'm excited to interview you today. \";\n    \n    if (position) {\n      greeting += `We'll be discussing the ${position} position. `;\n    }\n    \n    // Build opening message dynamically based on preliminaryCollected flag\n    if (!preliminaryCollected) {\n      // Append the single preliminary request\n      return greeting + \"Before we dive into the main interview, I'd like to get to know you better. Could you please tell me about your current role, your years of experience, and the main technologies or skills you work with?\";\n    } else {\n      // Immediately ask first domain-specific question\n      return greeting + this.generateFirstInterviewQuestion();\n    }\n  }\n\n  /**\n   * Generate the first interview question based on interview type\n   */\n  private generateFirstInterviewQuestion(): string {\n    const { type, position, company, difficulty } = this.interviewContext;\n    \n    switch (type) {\n      case 'technical':\n        if (difficulty === 'easy') {\n          return \"Let's start with some fundamentals. Can you explain the difference between an array and a linked list, and when you would choose one over the other?\";\n        } else if (difficulty === 'hard') {\n          return \"Let's dive into system design. How would you design a distributed caching system that can handle millions of requests per second with sub-millisecond latency?\";\n        } else {\n          return \"To get started, can you walk me through a recent technical challenge you faced and how you approached solving it?\";\n        }\n        \n      case 'behavioral':\n        if (company) {\n          return `Tell me about a time when you had to work with a difficult team member. How did you handle the situation and what was the outcome?`;\n        } else {\n          return \"Can you describe a situation where you had to lead a project or initiative? What was your approach and what did you learn from the experience?\";\n        }\n        \n      default:\n        if (position) {\n          return `What specifically interests you about this ${position} role, and how does it align with your career goals?`;\n        } else {\n          return \"What motivated you to pursue this opportunity, and what unique value do you think you can bring to our team?\";\n        }\n    }\n  }\n\n  /**\n   * Process user response and generate next question or comment\n   */\n  async processUserResponse(userResponse: string): Promise<GenerationResponse> {\n    console.log('💬 [TRACE] processUserResponse called', {\n      userResponse: userResponse.substring(0, 100) + '...',\n      historyLength: this.conversationHistory.length,\n      preliminaryCollected: this.interviewContext.preliminaryCollected,\n      currentQuestionCount: this.interviewContext.currentQuestionCount,\n      maxQuestions: this.interviewContext.maxQuestions,\n      timestamp: new Date().toISOString(),\n      callStack: new Error().stack?.split('\\n').slice(0, 5).join('\\n')\n    });\n    \n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    // Check if we're still collecting preliminary information\n    if (!this.interviewContext.preliminaryCollected) {\n      console.debug('🎯 [PRELIMINARY] Processing preliminary response', {\n        userResponseLength: userResponse.length,\n        timestamp: new Date().toISOString()\n      });\n      \n      // Process the preliminary response and set flag\n      const previousPreliminaryState = this.interviewContext.preliminaryCollected;\n      this.interviewContext.preliminaryCollected = true;\n      \n      console.debug('🔄 [STATE_TRANSITION] preliminaryCollected: false → true', {\n        previousState: previousPreliminaryState,\n        newState: true,\n        timestamp: new Date().toISOString()\n      });\n      \n      // Keep currentQuestionCount at 0 since we haven't asked real questions yet\n      this.interviewContext.currentQuestionCount = 0;\n      \n      // Generate first real interview question\n      const firstQuestion = this.generateFirstInterviewQuestion();\n      this.conversationHistory.push({ role: 'assistant', content: firstQuestion });\n      \n      // Increment to 1 for the first real question\n      const previousQuestionCount = this.interviewContext.currentQuestionCount;\n      this.interviewContext.currentQuestionCount = 1;\n      \n      console.debug('🔄 [STATE_TRANSITION] questionNumber: 0 → 1', {\n        previousCount: previousQuestionCount,\n        newCount: 1,\n        isFirstRealQuestion: true,\n        timestamp: new Date().toISOString()\n      });\n      \n      return {\n        content: `Thank you for that information! Now let's begin the interview.\\n\\n${firstQuestion}`,\n        questionNumber: 1,\n        isComplete: false,\n        followUpSuggestions: this.generateFollowUpSuggestions()\n      };\n    }\n\n    // Normal interview flow - add user response to conversation history\n    this.conversationHistory.push({ role: 'user', content: userResponse });\n    \n    console.log('📝 [TRACE] User response added to history', {\n      historyLength: this.conversationHistory.length,\n      timestamp: new Date().toISOString()\n    });\n\n    try {\n      const completion = await this.retryWithBackoff(async () => {\n        return await this.client!.chat.completions.create({\n          model: this.deployment,\n          messages: this.conversationHistory,\n          temperature: 0.7, // Standard temperature for balanced creativity\n          max_tokens: 200,\n          top_p: 0.9,\n          frequency_penalty: 0.1,\n          presence_penalty: 0.1,\n        });\n      });\n\n      const assistantResponse = completion.choices[0]?.message?.content || 'I\\'m sorry, I didn\\'t catch that. Could you repeat your answer?';\n      \n      console.log('🤖 [TRACE] OpenAI response received', {\n        response: assistantResponse.substring(0, 100) + '...',\n        questionCount: this.interviewContext.currentQuestionCount,\n        timestamp: new Date().toISOString()\n      });\n      \n      // Add assistant response to conversation history\n      this.conversationHistory.push({ role: 'assistant', content: assistantResponse });\n\n      const previousQuestionCount = this.interviewContext.currentQuestionCount || 0;\n      const currentQuestionCount = previousQuestionCount + 1;\n      const maxQuestions = this.interviewContext.maxQuestions || 10;\n      \n      console.log('📊 [TRACE] Question progression', {\n        currentQuestionCount,\n        maxQuestions,\n        isComplete: currentQuestionCount >= maxQuestions,\n        willContinue: currentQuestionCount < maxQuestions,\n        timestamp: new Date().toISOString()\n      });\n      \n      console.debug('🔄 [STATE_TRANSITION] questionNumber: %d → %d', \n        previousQuestionCount, \n        currentQuestionCount, \n        {\n          maxQuestions,\n          progressPercentage: Math.round((currentQuestionCount / maxQuestions) * 100),\n          remainingQuestions: Math.max(0, maxQuestions - currentQuestionCount),\n          timestamp: new Date().toISOString()\n        }\n      );\n      \n      // Update question count\n      this.interviewContext.currentQuestionCount = currentQuestionCount;\n\n      return {\n        content: assistantResponse,\n        questionNumber: currentQuestionCount,\n        isComplete: currentQuestionCount >= maxQuestions,\n        followUpSuggestions: this.generateFollowUpSuggestions()\n      };\n    } catch (error: any) {\n      console.error('❌ Error generating OpenAI response:', error);\n      \n      // Provide fallback response for common errors\n      if (error.status === 429) {\n        const fallbackResponse = this.getFallbackResponse(userResponse);\n        this.conversationHistory.push({ role: 'assistant', content: fallbackResponse });\n        \n        const currentQuestionCount = (this.interviewContext.currentQuestionCount || 0) + 1;\n        this.interviewContext.currentQuestionCount = currentQuestionCount;\n        \n        return {\n          content: fallbackResponse,\n          questionNumber: currentQuestionCount,\n          isComplete: false,\n          followUpSuggestions: this.generateFollowUpSuggestions()\n        };\n      }\n      \n      throw new Error('Failed to generate response');\n    }\n  }\n\n  /**\n   * Retry mechanism with exponential backoff for rate limiting\n   */\n  private async retryWithBackoff<T>(\n    operation: () => Promise<T>,\n    maxRetries: number = 3,\n    baseDelay: number = 1000\n  ): Promise<T> {\n    let lastError: Error;\n    \n    for (let attempt = 0; attempt <= maxRetries; attempt++) {\n      try {\n        return await operation();\n      } catch (error: any) {\n        lastError = error;\n        \n        // Don't retry on non-retryable errors\n        if (error.status && ![429, 500, 502, 503, 504].includes(error.status)) {\n          throw error;\n        }\n        \n        if (attempt === maxRetries) {\n          throw error;\n        }\n        \n        // Calculate delay with exponential backoff\n        const delay = error.status === 429 \n          ? parseInt(error.headers?.['retry-after'] || '10') * 1000\n          : baseDelay * Math.pow(2, attempt);\n        \n        console.log(`⏳ Retrying in ${delay}ms (attempt ${attempt + 1}/${maxRetries + 1})`);\n        await new Promise(resolve => setTimeout(resolve, delay));\n      }\n    }\n    \n    throw lastError!;\n  }\n\n  /**\n   * Generate fallback response when AI service is unavailable\n   */\n  private getFallbackResponse(userResponse: string): string {\n    const { type } = this.interviewContext;\n    \n    const fallbackResponses = {\n      technical: [\n        \"That's an interesting approach. Can you tell me more about the challenges you faced?\",\n        \"I see. How would you optimize this solution for better performance?\",\n        \"Good point. What alternative approaches did you consider?\"\n      ],\n      behavioral: [\n        \"Thank you for sharing that experience. What was the outcome?\",\n        \"That sounds challenging. What did you learn from that situation?\",\n        \"Interesting. How would you handle a similar situation now?\"\n      ],\n      general: [\n        \"That's great to hear. Can you elaborate on that?\",\n        \"Interesting background. What motivates you in your work?\",\n        \"I appreciate you sharing that. What are you most proud of?\"\n      ]\n    };\n    \n    const responses = fallbackResponses[type] || fallbackResponses.general;\n    return responses[Math.floor(Math.random() * responses.length)];\n  }\n\n  /**\n   * Generate follow-up suggestions based on conversation\n   */\n  private generateFollowUpSuggestions(): string[] {\n    const { type } = this.interviewContext;\n    \n    switch (type) {\n      case 'technical':\n        return [\n          \"Can you explain your thought process?\",\n          \"What would you do differently?\",\n          \"How would this scale?\"\n        ];\n      case 'behavioral':\n        return [\n          \"What was the outcome?\",\n          \"What did you learn?\",\n          \"How would you handle it now?\"\n        ];\n      default:\n        return [\n          \"Can you elaborate on that?\",\n          \"What was your biggest challenge?\",\n          \"What motivates you?\"\n        ];\n    }\n  }\n\n  /**\n   * Generate interview summary and feedback\n   */\n  async generateInterviewSummary(): Promise<string> {\n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    const summaryPrompt = {\n      role: 'system' as const,\n      content: `Based on the interview conversation, provide a brief summary of the candidate's performance, highlighting:\\n1. Key strengths demonstrated\\n2. Areas for improvement\\n3. Overall assessment\\n4. Recommendation\\n\\nKeep it concise and constructive (under 200 words).`\n    };\n\n    try {\n      const completion = await this.client.chat.completions.create({\n        model: this.deployment,\n        messages: [...this.conversationHistory, summaryPrompt],\n        temperature: 0.3,\n        max_tokens: 300,\n      });\n\n      return completion.choices[0]?.message?.content || 'Unable to generate summary.';\n    } catch (error) {\n      console.error('❌ Error generating interview summary:', error);\n      throw new Error('Failed to generate summary');\n    }\n  }\n\n  /**\n   * Get conversation history\n   */\n  getConversationHistory(): ConversationMessage[] {\n    return this.conversationHistory.filter(msg => msg.role !== 'system');\n  }\n\n  /**\n   * Clear conversation history\n   */\n  clearConversation(): void {\n    const previousState = {\n      historyLength: this.conversationHistory.length,\n      questionCount: this.interviewContext.currentQuestionCount,\n      preliminaryCollected: this.interviewContext.preliminaryCollected\n    };\n    \n    this.conversationHistory = [];\n    this.interviewContext.currentQuestionCount = 0;\n    this.interviewContext.preliminaryCollected = false;\n    \n    console.log('🧹 Conversation history cleared');\n    console.debug('🔄 [STATE_RESET] Conversation state reset', {\n      previousState,\n      newState: {\n        historyLength: 0,\n        questionCount: 0,\n        preliminaryCollected: false\n      },\n      timestamp: new Date().toISOString()\n    });\n  }\n\n  /**\n   * Generate questions based on resume information\n   */\n  async generateQuestions(resumeInfo: {name: string, experience: string, education: string, skills: string}): Promise<string[]> {\n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    const prompt = `Given the following resume information, generate 5 relevant interview questions. Format each question on a new line. Only return the questions, no additional text.\n\nName: ${resumeInfo.name}\nExperience: ${resumeInfo.experience}\nEducation: ${resumeInfo.education}\nSkills: ${resumeInfo.skills}`;\n\n    try {\n      const completion = await this.client.chat.completions.create({\n        model: this.deployment,\n        messages: [{role: 'system', content: prompt}],\n        temperature: 0.5,\n        max_tokens: 150\n      });\n\n      const response = completion.choices[0]?.message?.content || '';\n      return response\n        .split('\\n')\n        .map(q => q.trim())\n        .filter(q => q.length > 0)\n        .slice(0, 5);\n    } catch (error) {\n      console.error('❌ Error generating questions:', error);\n      throw new Error('Failed to generate questions');\n    }\n  }\n\n  /**\n   * Tailor resume based on job description using Azure OpenAI\n   */\n  async tailorResume(resumeText: string, jobDescription: string): Promise<string> {\n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    const prompt = `You are an expert resume writer and ATS optimization specialist. Please tailor this resume to better match the following job description for maximum ATS compatibility and relevance.\n\nJOB DESCRIPTION:\n${jobDescription}\n\nCURRENT RESUME:\n${resumeText}\n\nPlease provide a tailored version of the resume that:\n1. Uses keywords and phrases directly from the job description\n2. Highlights relevant skills and experiences that match the job requirements\n3. Maintains professional formatting and ATS-friendly structure\n4. Uses strong action verbs and quantifiable achievements\n5. Keeps the same overall length and format structure\n6. Optimizes for Applicant Tracking Systems (ATS)\n7. Ensures keyword density without keyword stuffing\n\nReturn ONLY the tailored resume content with no additional commentary or explanations.`;\n\n    try {\n      const completion = await this.retryWithBackoff(async () => {\n        return await this.client!.chat.completions.create({\n          model: this.deployment,\n          messages: [{ role: 'user', content: prompt }],\n          temperature: 0.3,\n          max_tokens: 2000,\n          top_p: 0.9,\n          frequency_penalty: 0.1,\n          presence_penalty: 0.1,\n        });\n      });\n\n      const tailoredResume = completion.choices[0]?.message?.content;\n      if (!tailoredResume) {\n        throw new Error('No response generated');\n      }\n\n      return tailoredResume;\n    } catch (error) {\n      console.error('❌ Error tailoring resume:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check if service is ready\n   */\n  isReady(): boolean {\n    return this.isInitialized && this.client !== null;\n  }\n\n  /**\n   * Generate a completion for a given prompt\n   */\n  async generateCompletion(prompt: string): Promise<string> {\n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    try {\n      const completion = await this.createCompletion([\n        {\n          role: 'user',\n          content: prompt\n        }\n      ], {\n        temperature: 0.7,\n        maxTokens: 1000\n      });\n\n      return completion.choices[0]?.message?.content || 'Unable to generate completion.';\n    } catch (error) {\n      console.error('❌ Error generating completion:', error);\n      throw new Error('Failed to generate completion');\n    }\n  }\n\n  /**\n   * Create a chat completion with custom parameters\n   * Public method for use by adapters\n   */\n  async createCompletion(\n    messages: Array<{ role: 'user' | 'system' | 'assistant'; content: string }>,\n    options: {\n      temperature?: number;\n      maxTokens?: number;\n      topP?: number;\n      frequencyPenalty?: number;\n      presencePenalty?: number;\n    } = {}\n  ) {\n    if (!this.isInitialized || !this.client) {\n      throw new Error('Azure OpenAI Service not initialized');\n    }\n\n    const {\n      temperature = 0.7,     // Default temperature for balanced responses\n      maxTokens = 1500,      // Default max tokens for comprehensive responses\n      topP = 0.9,            // Maintain creativity balance\n      frequencyPenalty = 0.1, // Reduce repetition\n      presencePenalty = 0.1   // Encourage diverse content\n    } = options;\n\n    return await this.retryWithBackoff(async () => {\n      return await this.client!.chat.completions.create({\n        model: this.deployment,\n        messages,\n        temperature,\n        max_tokens: maxTokens,\n        top_p: topP,\n        frequency_penalty: frequencyPenalty,\n        presence_penalty: presencePenalty,\n      });\n    });\n  }\n\n  /**\n   * Dispose of resources\n   */\n  dispose(): void {\n    this.client = null;\n    this.isInitialized = false;\n    this.conversationHistory = [];\n    console.log('🧹 Azure OpenAI Service disposed');\n  }\n}\n\n// Export singleton instance\nexport const azureOpenAIService = new AzureOpenAIService();\n"],"version":3}